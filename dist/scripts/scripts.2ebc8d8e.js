"use strict";angular.module("ultraBI",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","googlechart"]).config(["$routeProvider",function(a){a.when("/ultradashboard",{templateUrl:"views/ultradashboard.html",controller:"UltradashboardCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/ultradashboard"})}]).filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}),angular.module("ultraBI").controller("MainCtrl",["$scope","$location",function(a,b){a.$watch(function(){return b.path()},function(b){b.includes("dashboard")&&(a.activeView="dashboard"),b.includes("ultradashboard")&&(a.activeView="ultradashboard")})}]),angular.module("ultraBI").service("VendasService",["$resource",function(a){return a("Vendas.json")}]),angular.module("ultraBI").service("FiliaisService",["$resource",function(a){return a("Filiais.json")}]),angular.module("ultraBI").service("ClientesService",["$resource",function(a){return a("Clientes2.json")}]),angular.module("ultraBI").controller("UltradashboardCtrl",["$scope","$filter","ClientesService","FiliaisService","VendasService",function(a,b,c,d,e){function f(a,b,c,d){return _.chain(a).groupBy(b).toPairs().map(function(a){return _.zipObject([c,d],a)}).value()}a.cssStyle="height:600px;",a.baseVendas=e.query(),a.vendas=a.baseVendas,a.filiais=[],a.clientes=[],a.periodosAnuais=[],a.periodosMensais=[{numero:1,mes:"Janeiro",abrev:"Jan"},{numero:2,mes:"Fevereiro",abrev:"Fev"},{numero:3,mes:"Março",abrev:"Mar"},{numero:4,mes:"Abril",abrev:"Abr"},{numero:5,mes:"Maio",abrev:"Mai"},{numero:6,mes:"Junho",abrev:"Jun"},{numero:7,mes:"Julho",abrev:"Jul"},{numero:8,mes:"Agosto",abrev:"Ago"},{numero:9,mes:"Setembro",abrev:"Set"},{numero:10,mes:"Outubro",abrev:"Out"},{numero:11,mes:"Novembro",abrev:"Nov"},{numero:12,mes:"Dezembro",abrev:"Dez"}],a.periodosAnuais=[],a.filiaisToFilter=[],a.filiaisFiltradas=[],a.clientesToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.mbPeriodosAnuaisToFilter=[],a.periodosMensaisToFilter=[],a.periodosAnuaisFiltrados=[],a.filterActivated=!1,a.activeFilialToFilter=!1,a.activeClientesToFilter=!1,a.activeVendasPeriodoAnualToFilter=!1,a.activeMBPeriodoAnualToFilter=!1,a.activePeriodoMensalToFilter=!1,a.numPerPage=5,a.noOfPages=Math.ceil(a.filiais.length/a.numPerPage),a.currentPage=1,a.setPage=function(){a.data=a.filiais.slice((a.currentPage-1)*a.numPerPage,a.numPerPage)},a.$watch("currentPage",a.setPage),a.filtrarFilial=function(a,b){a.filtered=!!b},a.aplicarFiltros=function(){var c=b("filter")(a.filiais,{filtered:!0});c.length>0&&c.forEach(function(b){0===_.filter(a.filiaisFiltradas,function(a){return a===b.filial}).length&&a.filiaisFiltradas.push(b.filial)}),a.filtrarFiliais()},a.filiaisToFilter=[],a.clientesToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.mbPeriodosAnuaisToFilter=[],a.periodosMensaisToFilter=[],a.activeFilialToFilter=!1,a.activeClientesToFilter=!1,a.activeVendasPeriodoAnualToFilter=!1,a.activeMBPeriodoAnualToFilter=!1,a.activePeriodoMensalToFilter=!1,a.addFilialToFilter=function(c){a.activeFilialToFilter===!1&&(a.activeFilialToFilter=!0);var d=parseInt(a.pieChartVendasFiliais.data[(c.row,c.row+1)][0].split(" ")[1]);0===b("filter")(a.filiaisToFilter,"filialFiltered").length&&a.filiaisToFilter.push(d)},a.filtrarFiliais=function(){var b=[];a.filiaisToFilter.length>0?a.filiaisFiltradas=a.filiaisToFilter:a.filiaisToFilter=a.filiaisFiltradas,0===a.periodosAnuaisFiltrados.length&&(a.vendas=a.baseVendas),a.filiaisToFilter.forEach(function(c){_.filter(a.vendas,function(a){return a.filial.id===c}).forEach(function(a){b.push(a)})}),a.filiais.forEach(function(b){_.filter(a.filiaisToFilter,function(a){return a===b.filial}).length>0?b.filtered=!0:b.filtered=!1}),console.log(b),a.vendas=b,a.filiaisToFilter=[],a.activeFilialToFilter=!1,a.filterActivated||(a.filterActivated=!0),l(a.vendas)},a.cancelFiliaisFilter=function(){a.activeFilialToFilter=!1,a.filiaisToFilter=[],limparFiltros()},a.addVendasAnoToFilter=function(c){a.activeVendasPeriodoAnualToFilter===!1&&(a.activeVendasPeriodoAnualToFilter=!0);var d=parseInt(a.columnsVendasAno.data[(c.column,c.row+1)][0]);0===b("filter")(a.vendasPeriodosAnuaisToFilter,"anoFiltered").length&&a.vendasPeriodosAnuaisToFilter.push(d)},a.filtrarVendasPeriodoAnuais=function(){var c=[];a.vendasPeriodosAnuaisToFilter.forEach(function(d){b("filter")(a.vendas,{ANO:d}).forEach(function(a){c.push(a)})}),a.vendas=c,a.filiaisToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.activeVendasPeriodoAnualToFilter=!1},a.checkEmptyFilters=function(){0===a.filiaisFiltradas.length&&0===a.periodosAnuaisFiltrados.length?(a.vendas=_.union(a.vendas,a.baseVendas),l(a.vendas),a.filterActivated=!1):(a.periodosAnuaisFiltrados.length>0&&a.filtrarMBPeriodoAnuais(),a.filiaisFiltradas.length>0&&a.filtrarFiliais())},a.limparFiltrosFiliais=function(){a.filiaisToFilter=[],a.filtrarFiliais()},a.cancelVendasPeriodosAnuaisFilter=function(){a.activeVendasPeriodoAnualToFilter=!1,a.filiaisToFilter=[],a.vendasPeriodosAnuaisToFilter=[],limparFiltros()},a.addMBAnoToFilter=function(c){a.activeMBPeriodoAnualToFilter===!1&&(a.activeMBPeriodoAnualToFilter=!0);var d=parseInt(a.columnsMargemBrutaAnual.data[(c.column,c.row+1)][0]);0===b("filter")(a.mbPeriodosAnuaisToFilter,"anoFiltered").length&&a.mbPeriodosAnuaisToFilter.push(d)},a.filtrarMBPeriodoAnuais=function(){var c=[];a.mbPeriodosAnuaisToFilter.length>0?a.periodosAnuaisFiltrados=a.mbPeriodosAnuaisToFilter:a.mbPeriodosAnuaisToFilter=a.periodosAnuaisFiltrados,0===a.filiaisFiltradas.length&&(a.vendas=a.baseVendas),a.mbPeriodosAnuaisToFilter.forEach(function(d){var e=b("filter")(a.vendas,{ano:d});c=_.union(c,e)}),a.vendas=[],a.vendas=_.union(a.vendas,c),a.vendas=c,a.filiaisToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.mbPeriodosAnuaisToFilter=[],a.activeMBPeriodoAnualToFilter=!1,a.filterActivated||(a.filterActivated=!0),l(a.vendas)},a.cancelMbPeriodosAnuaisFilter=function(){a.activeMBPeriodoAnualToFilter=!1,a.filiaisToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.mbPeriodosAnuaisToFilter=[],limparFiltros()},a.limparFiltros=function(){a.vendas=[],a.vendas=_.union(a.vendas,a.baseVendas),l(a.vendas),a.filiaisToFilter=[],a.vendasPeriodosAnuaisToFilter=[],a.mbPeriodosAnuaisToFilter=[],a.filiaisFiltradas=[],a.periodosAnuaisFiltrados=[],a.filterActivated=!1},a.removerFiltroAno=function(b){a.periodosAnuaisFiltrados.pop(b),a.mbPeriodosAnuaisToFilter=a.periodosAnuaisFiltrados,a.mbPeriodosAnuaisToFilter.length>0?a.filtrarMBPeriodoAnuais():a.checkEmptyFilters()},a.removerFiltroFilial=function(b){a.filiaisFiltradas.pop(b),a.filiaisToFilter=a.filiaisFiltradas,a.filiaisToFilter.length>0?a.filtrarFiliais():a.checkEmptyFilters()},a.periodosAnuais.meses=a.periodosMensais;var g={number:[{columnNum:1,prefix:"R$"}]},h=function(b){a.pieChartVendasFiliais={type:"PieChart",displayed:!0,data:[["Filial","Total"]],options:{title:"Vendas por Filial",pieHole:.4,height:300,width:300},formatters:g};var c=f(b,"filial.id","filial","vendas");c.length>0&&c.forEach(function(b){a.pieChartVendasFiliais.data.push(["Filial "+b.filial,_.sumBy(b.vendas,"total")])})},i=function(b){a.columnsVendasMes={type:"ColumnChart",displayed:!0,data:[["Mês","Total Vendas"]],options:{title:"Total de Vendas Mensal",animation:{duration:500,easing:"linear"},legend:"none",height:300},formatters:g};var c=f(b,"mes","mes","vendas");c.length>0&&c.forEach(function(b){a.columnsVendasMes.data.push([b.mes.toString(),_.sumBy(b.vendas,"total")])})},j=function(b){a.columnsVendasAno={type:"ColumnChart",displayed:!0,data:[["Ano","Total Vendas"]],options:{title:"Total de Vendas Anual",animation:{duration:500,easing:"linear"},legend:"none",height:300},formatters:g},a.columnsMargemBrutaAnual={type:"ColumnChart",displayed:!0,data:[["Ano","Média de Margem Bruta"]],options:{title:"Média de Margem Bruta Anual",animation:{duration:500,easing:"linear"},legend:"none",height:300},formatters:g};var c=f(b,"ano","ano","vendas");c.length>0&&c.forEach(function(b){a.columnsVendasAno.data.push([b.ano.toString(),_.sumBy(b.vendas,"total")]),a.columnsMargemBrutaAnual.data.push([b.ano.toString(),_.meanBy(b.vendas,"valorMargemBruta")])})},k=function(b){var c={type:"BarChart",displayed:!0,data:[["Cliente","Total Vendas"]],options:{title:"Clientes",isStacked:"true",animation:{duration:500,easing:"linear"},legend:"none",pieHole:.4,height:800,width:300},formatters:g},d=f(b,"cliente.nome","cliente","vendas");d.forEach(function(a){a.total=_.sumBy(a.vendas,"total")});var e=_.orderBy(d,["total"],["desc"]);e=e.slice(0,10),e.length>0&&e.forEach(function(a){c.data.push([a.cliente,_.sumBy(a.vendas,"total")])}),a.barClienteChart=c},l=function(a){k(a),h(a),j(a),i(a)};a.$watch("baseVendas.length",function(){l(a.baseVendas),f(a.baseVendas,"filial.id","filial","vendas").forEach(function(b){b.filial=parseInt(b.filial),b.filtered=!1,b.vendas=null,a.filiais.push(b)}),console.log("Filiais"),console.log(a.filiais)})}]),angular.module("appDashboardApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);